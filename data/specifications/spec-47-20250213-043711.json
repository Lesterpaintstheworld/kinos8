{
  "specificationId": "spec-47-20250213-043711",
  "collaborationId": "47",
  "title": "Market Notification Service - Technical Specification",
  "content": "# Market Notification Service Technical Specification\n\n## Phase 1: Core Notification System\n\n### Telegram Bot Commands\n\n1. `/start` \n- Welcomes user\n- Explains service\n- Checks if user is in Airtable allowlist\n\n2. `/watchlist`\n- Shows current watched swarms\n- Displays current price thresholds\n\n3. `/help`\n- Lists available commands\n- Provides command usage examples\n\n### n8n Workflows\n\n1. User Authentication Flow:\n```\nTelegram Trigger → Airtable Query (allowlist) → Response Handler\n```\n\n2. Price Monitor Flow (runs every 5 minutes):\n```\nSchedule → Airtable Query (watchlists) → HTTP Request (price data) → Filter (threshold check) → Telegram Alert\n```\n\n3. Status Update Flow (daily):\n```\nSchedule → Airtable Query (active users) → Generate Report → Telegram Alert\n```\n\n### Airtable Structure\n\n1. Users Table:\n- TelegramID\n- Username\n- Status (active/inactive)\n- JoinDate\n\n2. Watchlists Table:\n- TelegramID\n- SwarmID\n- MaxPrice\n- NotificationEnabled\n\n## Phase 2: Full Automation\n\n### Additional Telegram Commands\n\n1. `/subscribe`\n- Initiates subscription process\n- Displays pricing information\n- Generates payment link\n\n2. `/add <swarm> <price>`\n- Adds swarm to watchlist\n- Sets price threshold\n\n3. `/remove <swarm>`\n- Removes swarm from watchlist\n\n4. `/settings`\n- Manages notification preferences\n- Updates price thresholds\n\n5. `/status`\n- Shows subscription status\n- Displays usage statistics\n\n### Additional n8n Workflows\n\n1. Subscription Management Flow:\n```\nPayment Webhook → Update Airtable → Send Welcome → Enable Monitoring\n```\n\n2. Analytics Flow (weekly):\n```\nSchedule → Collect Metrics → Generate Report → Store Results → Alert Admin\n```\n\n3. Auto-renewal Flow:\n```\nSchedule → Check Expiring → Payment Request → Update Status\n```\n\n### Extended Airtable Structure\n\n1. Subscriptions Table:\n- TelegramID\n- PlanType\n- StartDate\n- EndDate\n- PaymentStatus\n\n2. Analytics Table:\n- Date\n- ActiveUsers\n- AlertsSent\n- ResponseRate\n\n## Implementation Priority\n\nPhase 1 (Days 1-3):\n1. Basic bot setup with /start, /watchlist, /help\n2. Price monitoring workflow\n3. Manual user management via Airtable\n\nPhase 2 (Days 4-5):\n1. Subscription commands\n2. Payment integration\n3. Analytics system\n\n## Technical Requirements\n\n1. Infrastructure:\n- n8n instance on KinOS\n- Telegram Bot API access\n- Airtable API integration\n\n2. Data Storage:\n- Airtable for user management\n- n8n for workflow state\n- Temporary cache for price data\n\n3. Monitoring:\n- Workflow execution logs\n- Alert delivery confirmation\n- Error tracking\n\n## Security Considerations\n\n1. User Authentication:\n- Telegram user verification\n- Airtable access control\n- API key management\n\n2. Data Protection:\n- Encrypted communication\n- Rate limiting\n- Access logging\n\n## Testing Strategy\n\n1. Phase 1:\n- Command response accuracy\n- Price threshold triggers\n- Alert delivery timing\n\n2. Phase 2:\n- Subscription flow\n- Payment processing\n- Analytics accuracy",
  "createdAt": "2025-02-13"
}
